module mod_D3Q27setup
   use mod_dimensions
   implicit none



   real, parameter :: cs2=1/3.0
   real, parameter :: cs4=1/9.0
   real, parameter :: cs6=1/27.0


! Define velocity vectors
!                                           1  2  3  4  5  6  7  8  9  0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5  6  7
   integer, parameter :: cxs_h(1:nl)     = [0, 1,-1, 0, 0, 0, 0, 1,-1, 1,-1,-1, 1, 0, 0,-1, 1, 0, 0,-1, 1,-1, 1, 1,-1,-1, 1]
   integer, parameter :: cys_h(1:nl)     = [0, 0, 0, 1,-1, 0, 0, 1,-1,-1, 1, 0, 0, 1,-1, 0, 0,-1, 1, 1,-1,-1, 1, 1,-1, 1,-1]
   integer, parameter :: czs_h(1:nl)     = [0, 0, 0, 0, 0,-1, 1, 0, 0, 0, 0,-1, 1, 1,-1, 1,-1, 1,-1, 1,-1,-1, 1,-1, 1,-1, 1]
   integer, parameter :: bounce_h(1:nl)  = [1, 3, 2, 5, 4, 7, 6, 9, 8,11,10,13,12,15,14,17,16,19,18,21,20,23,22,25,24,27,26]
   real,    parameter :: weights_h(1:nl) = [8.0/27.0, &
                                            2.0/27.0, 2.0/27.0, 2.0/27.0, 2.0/27.0, 2.0/27.0, 2.0/27.0, &
                                            1.0/54.0, 1.0/54.0, 1.0/54.0, 1.0/54.0, 1.0/54.0, 1.0/54.0, &
                                            1.0/54.0, 1.0/54.0, 1.0/54.0, 1.0/54.0, 1.0/54.0, 1.0/54.0, &
                                            1.0/216.0, 1.0/216.0, 1.0/216.0, 1.0/216.0, 1.0/216.0, 1.0/216.0, 1.0/216.0, 1.0/216.0]


   integer, allocatable :: cxs(:)
   integer, allocatable :: cys(:)
   integer, allocatable :: czs(:)
   integer, allocatable :: bounce(:)
   real,  dimension(:)      , allocatable :: weights
   real,  dimension(:,:,:)  , allocatable :: H2
   real,  dimension(:,:,:,:), allocatable :: H3
#ifdef _CUDA
   attributes(device) :: cxs
   attributes(device) :: cys
   attributes(device) :: czs
   attributes(device) :: bounce
   attributes(device) :: weights
   attributes(device) :: H2
   attributes(device) :: H3
#endif

end module



!  ! Define weights
!   real, parameter :: weights(1:nl) = [8./27.,                                                                     & ! 0-center
!        2./27., 2./27., 2./27., 2./27., 2./27., 2./27.,                                                 & ! 1-6
!        1./54., 1./54., 1./54., 1./54., 1./54., 1./54., 1./54., 1./54., 1./54., 1./54., 1./54., 1./54., & ! 7-18
!        1./216., 1./216., 1./216., 1./216., 1./216., 1./216., 1./216., 1./216.]                           ! 19-26
!
!   real, parameter :: H2(3,3,nl) = &
!           reshape((/ -1.0/3.0,  0.0,  0.0,  0.0, -1.0/3.0,  0.0,  0.0,  0.0, -1.0/3.0, &
!                       2.0/3.0,  0.0,  0.0,  0.0, -1.0/3.0,  0.0,  0.0,  0.0, -1.0/3.0, &
!                       2.0/3.0,  0.0,  0.0,  0.0, -1.0/3.0,  0.0,  0.0,  0.0, -1.0/3.0, &
!                      -1.0/3.0,  0.0,  0.0,  0.0,  2.0/3.0,  0.0,  0.0,  0.0, -1.0/3.0, &
!                      -1.0/3.0,  0.0,  0.0,  0.0,  2.0/3.0,  0.0,  0.0,  0.0, -1.0/3.0, &
!                      -1.0/3.0,  0.0,  0.0,  0.0, -1.0/3.0,  0.0,  0.0,  0.0,  2.0/3.0, &
!                      -1.0/3.0,  0.0,  0.0,  0.0, -1.0/3.0,  0.0,  0.0,  0.0,  2.0/3.0, &
!                       2.0/3.0,  1.0,  0.0,  1.0,  2.0/3.0,  0.0,  0.0,  0.0, -1.0/3.0, &
!                       2.0/3.0,  1.0,  0.0,  1.0,  2.0/3.0,  0.0,  0.0,  0.0, -1.0/3.0, &
!                       2.0/3.0, -1.0,  0.0, -1.0,  2.0/3.0,  0.0,  0.0,  0.0, -1.0/3.0, &
!                       2.0/3.0, -1.0,  0.0, -1.0,  2.0/3.0,  0.0,  0.0,  0.0, -1.0/3.0, &
!                       2.0/3.0,  0.0,  1.0,  0.0, -1.0/3.0,  0.0,  1.0,  0.0,  2.0/3.0, &
!                       2.0/3.0,  0.0,  1.0,  0.0, -1.0/3.0,  0.0,  1.0,  0.0,  2.0/3.0, &
!                      -1.0/3.0,  0.0,  0.0,  0.0,  2.0/3.0,  1.0,  0.0,  1.0,  2.0/3.0, &
!                      -1.0/3.0,  0.0,  0.0,  0.0,  2.0/3.0,  1.0,  0.0,  1.0,  2.0/3.0, &
!                       2.0/3.0,  0.0, -1.0,  0.0, -1.0/3.0,  0.0, -1.0,  0.0,  2.0/3.0, &
!                       2.0/3.0,  0.0, -1.0,  0.0, -1.0/3.0,  0.0, -1.0,  0.0,  2.0/3.0, &
!                      -1.0/3.0,  0.0,  0.0,  0.0,  2.0/3.0, -1.0,  0.0, -1.0,  2.0/3.0, &
!                      -1.0/3.0,  0.0,  0.0,  0.0,  2.0/3.0, -1.0,  0.0, -1.0,  2.0/3.0, &
!                       2.0/3.0, -1.0, -1.0, -1.0,  2.0/3.0,  1.0, -1.0,  1.0,  2.0/3.0, &
!                       2.0/3.0, -1.0, -1.0, -1.0,  2.0/3.0,  1.0, -1.0,  1.0,  2.0/3.0, &
!                       2.0/3.0,  1.0,  1.0,  1.0,  2.0/3.0,  1.0,  1.0,  1.0,  2.0/3.0, &
!                       2.0/3.0,  1.0,  1.0,  1.0,  2.0/3.0,  1.0,  1.0,  1.0,  2.0/3.0, &
!                       2.0/3.0,  1.0, -1.0,  1.0,  2.0/3.0, -1.0, -1.0, -1.0,  2.0/3.0, &
!                       2.0/3.0,  1.0, -1.0,  1.0,  2.0/3.0, -1.0, -1.0, -1.0,  2.0/3.0, &
!                       2.0/3.0, -1.0,  1.0, -1.0,  2.0/3.0, -1.0,  1.0, -1.0,  2.0/3.0, &
!                       2.0/3.0, -1.0,  1.0, -1.0,  2.0/3.0, -1.0,  1.0, -1.0,  2.0/3.0  /), shape(H2))
!
!! Third order Hermite polynomial
!  real, parameter :: H3(3,3,3,nl) = reshape((/ &
!  0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,                                                &
!  0.,0.,0.,0.,-1./3.,0.,0.,0.,-1./3.,0.,-1./3.,0.,-1./3.,0.,0.,0.,0.,0.,0.,0.,-1./3.,0.,0.,0.,-1./3.,0.,0.,                        &
!  0.,0.,0.,0.,1./3.,-0.,0.,-0.,1./3.,0.,1./3.,-0.,1./3.,0.,0.,-0.,0.,0.,0.,-0.,1./3.,-0.,0.,0.,1./3.,0.,0.,                        &
!  0.,-1./3.,0.,-1./3.,0.,0.,0.,0.,0.,-1./3.,0.,0.,0.,0.,0.,0.,0.,-1./3.,0.,0.,0.,0.,0.,-1./3.,0.,-1./3.,0.,                        &
!  0.,1./3.,0.,1./3.,0.,-0.,0.,-0.,0.,1./3.,0.,-0.,0.,0.,0.,-0.,0.,1./3.,0.,-0.,0.,-0.,0.,1./3.,0.,1./3.,0.,                        &
!  0.,0.,1./3.,0.,0.,-0.,1./3.,-0.,0.,0.,0.,-0.,0.,0.,1./3.,-0.,1./3.,0.,1./3.,-0.,0.,-0.,1./3.,0.,0.,0.,0.,                        &
!  0.,0.,-1./3.,0.,0.,0.,-1./3.,0.,0.,0.,0.,0.,0.,0.,-1./3.,0.,-1./3.,0.,-1./3.,0.,0.,0.,-1./3.,0.,0.,0.,0.,                        &
!  0.,2./3.,0.,2./3.,2./3.,0.,0.,0.,-1./3.,2./3.,2./3.,0.,2./3.,0.,0.,0.,0.,-1./3.,0.,0.,-1./3.,0.,0.,-1./3.,-1./3.,-1./3.,0.,      &
!  0.,-2./3.,0.,-2./3.,-2./3.,0.,0.,0.,1./3.,-2./3.,-2./3.,0.,-2./3.,0.,0.,0.,0.,1./3.,0.,0.,1./3.,0.,0.,1./3.,1./3.,1./3.,0.,      &
!  0.,-2./3.,0.,-2./3.,2./3.,-0.,0.,-0.,-1./3.,-2./3.,2./3.,-0.,2./3.,0.,0.,-0.,0.,1./3.,0.,-0.,-1./3.,-0.,0.,1./3.,-1./3.,1./3.,0.,&
!  0.,2./3.,0.,2./3.,-2./3.,-0.,0.,-0.,1./3.,2./3.,-2./3.,-0.,-2./3.,0.,0.,-0.,0.,-1./3.,0.,-0.,1./3.,-0.,0.,-1./3.,1./3.,-1./3.,0.,&
!  0.,0.,-2./3.,0.,1./3.,0.,-2./3.,0.,-2./3.,0.,1./3.,0.,1./3.,0.,1./3.,0.,1./3.,0.,-2./3.,0.,-2./3.,0.,1./3.,0.,-2./3.,0.,0.,      &
!  0.,0.,2./3.,0.,-1./3.,0.,2./3.,0.,2./3.,0.,-1./3.,0.,-1./3.,0.,-1./3.,0.,-1./3.,0.,2./3.,0.,2./3.,0.,-1./3.,0.,2./3.,0.,0.,      &
!  0.,-1./3.,-1./3.,-1./3.,0.,0.,-1./3.,0.,0.,-1./3.,0.,0.,0.,0.,2./3.,0.,2./3.,2./3.,-1./3.,0.,0.,0.,2./3.,2./3.,0.,2./3.,0.,      &
!  0.,1./3.,1./3.,1./3.,0.,0.,1./3.,0.,0.,1./3.,0.,0.,0.,0.,-2./3.,0.,-2./3.,-2./3.,1./3.,0.,0.,0.,-2./3.,-2./3.,0.,-2./3.,0.,      &
!  0.,0.,2./3.,0.,1./3.,-0.,2./3.,-0.,-2./3.,0.,1./3.,-0.,1./3.,0.,-1./3.,-0.,-1./3.,0.,2./3.,-0.,-2./3.,-0.,-1./3.,0.,-2./3.,0.,0.,&
!  0.,0.,-2./3.,0.,-1./3.,-0.,-2./3.,-0.,2./3.,0.,-1./3.,-0.,-1./3.,0.,1./3.,-0.,1./3.,0.,-2./3.,-0.,2./3.,-0.,1./3.,0.,2./3.,0.,0.,&
!  0.,1./3.,-1./3.,1./3.,0.,-0.,-1./3.,-0.,0.,1./3.,0.,-0.,0.,0.,2./3.,-0.,2./3.,-2./3.,-1./3.,-0.,0.,-0.,2./3.,-2./3.,0.,-2./3.,0.,&
!  0.,-1./3.,1./3.,-1./3.,0.,-0.,1./3.,-0.,0.,-1./3.,0.,-0.,0.,0.,-2./3.,-0.,-2./3.,2./3.,1./3.,-0.,0.,-0.,-2./3.,2./3.,0.,2./3.,0.,&
!  0.,2./3.,2./3.,2./3.,-2./3.,-1.,2./3.,-1.,-2./3.,2./3.,-2./3.,-1.,-2./3.,0.,2./3.,-1.,2./3.,2./3.,2./3.,-1.,-2./3.,-1.,2./3.,    &
!                                                                                                             2./3.,-2./3.,2./3.,0.,&
!  0.,-2./3.,-2./3.,-2./3.,2./3.,1.,-2./3.,1.,2./3.,-2./3.,2./3.,1.,2./3.,0.,-2./3.,1.,-2./3.,-2./3.,-2./3.,1.,2./3.,1.,-2./3.,     &
!                                                                                                            -2./3.,2./3.,-2./3.,0.,&
!  0.,-2./3.,-2./3.,-2./3.,-2./3.,-1.,-2./3.,-1.,-2./3.,-2./3.,-2./3.,-1.,-2./3.,0.,-2./3.,-1.,-2./3.,-2./3.,-2./3.,-1.,-2./3.,-1., &
!                                                                                                    -2./3.,-2./3.,-2./3.,-2./3.,0.,&
!  0.,2./3.,2./3.,2./3.,2./3.,1.,2./3.,1.,2./3.,2./3.,2./3.,1.,2./3.,0.,2./3.,1.,2./3.,2./3.,2./3.,1.,2./3.,1.,2./3.,2./3.,2./3.,   &
!                                                                                                                          2./3.,0.,&
!  0.,2./3.,-2./3.,2./3.,2./3.,-1.,-2./3.,-1.,2./3.,2./3.,2./3.,-1.,2./3.,0.,-2./3.,-1.,-2./3.,2./3.,-2./3.,-1.,2./3.,-1.,-2./3.,   &
!                                                                                                              2./3.,2./3.,2./3.,0.,&
!  0.,-2./3.,2./3.,-2./3.,-2./3.,1.,2./3.,1.,-2./3.,-2./3.,-2./3.,1.,-2./3.,0.,2./3.,1.,2./3.,-2./3.,2./3.,1.,-2./3.,1.,2./3.,      &
!                                                                                                           -2./3.,-2./3.,-2./3.,0.,&
!  0.,2./3.,-2./3.,2./3.,-2./3.,1.,-2./3.,1.,-2./3.,2./3.,-2./3.,1.,-2./3.,0.,-2./3.,1.,-2./3.,2./3.,-2./3.,1.,-2./3.,1.,-2./3.,    &
!                                                                                                             2./3.,-2./3.,2./3.,0.,&
!  0.,-2./3.,2./3.,-2./3.,2./3.,-1.,2./3.,-1.,2./3.,-2./3.,2./3.,-1.,2./3.,0.,2./3.,-1.,2./3.,-2./3.,2./3.,-1.,2./3.,-1.,2./3.,     &
!                                                                                              -2./3.,2./3.,-2./3.,0./), shape(H3))


